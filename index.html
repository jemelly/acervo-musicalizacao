<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Acervo de Musicalização</title>
  <style>
    /* Estilos globais para o corpo da página */
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 900px;
      margin: auto;
      transition: background-color 0.5s ease, background-image 0.5s ease; /* Transição suave para o background */
    }

    /* Animação para o plano de fundo do body (se for um gradiente animado) */
    @keyframes gradientAnimation {
        0% {background-position: 0% 50%;}
        50% {background-position: 100% 50%;}
        100% {background-position: 0% 50;}
    }

    /* Estilo para o título principal */
    h1 {
      text-align: center;
      font-size: 2.5em;
      color: #5c33a2; /* Cor roxa */
      margin-bottom: 10px;
    }
    /* Estilo para os subtítulos */
    h2 {
      color: #444;
      margin-bottom: 10px;
    }
    /* Estilo para o container principal da aplicação */
    .container {
      background-color: rgba(255, 255, 255, 0.9); /* Branco quase opaco */
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); /* Sombra um pouco mais forte */
    }
    /* Margem superior para seções específicas */
    .activity-form, .search-bar, .activity-list, .background-settings {
      margin-top: 30px;
    }
    /* Estilo para inputs e textareas */
    input, textarea {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-sizing: border-box; /* Inclui padding e border na largura */
    }
    /* Ajuste para textarea */
    textarea {
      resize: vertical; /* Permite redimensionar verticalmente */
      min-height: 80px;
    }
    /* Estilo para botões gerais */
    button {
      background: linear-gradient(to right, #5c33a2, #8e44ad); /* Gradiente roxo */
      color: white;
      padding: 12px 20px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease; /* Transição suave no hover */
      margin-right: 10px; /* Adicionado para espaçamento entre botões no formulário */
    }
    button:hover {
      background: linear-gradient(to right, #512d91, #732d91); /* Gradiente mais escuro no hover */
    }
    /* Estilo específico para o botão de apagar */
    .delete-button {
      background: #ff4d4d; /* Vermelho */
      margin-top: 10px;
      margin-right: 0; /* Remover margin-right para botão de apagar */
    }
    .delete-button:hover {
      background: #cc0000; /* Vermelho mais escuro no hover */
    }
    /* Estilo para o botão de editar */
    .edit-button {
        background: #ffc107; /* Amarelo */
        color: #333; /* Texto escuro para contraste */
    }
    .edit-button:hover {
        background: #e0a800; /* Amarelo mais escuro */
    }
    /* Estilo para o botão de cancelar edição ou configurações */
    .cancel-button {
        background: #6c757d; /* Cinza */
    }
    .cancel-button:hover {
        background: #5a6268; /* Cinza mais escuro */
    }

    /* Estilo para cada cartão de atividade */
    .activity-card {
      border-left: 6px solid #8e44ad; /* Borda esquerda roxa */
      background-color: #faf9ff; /* Fundo claro */
      padding: 15px;
      margin-top: 15px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); /* Sombra suave */
    }
    .activity-card h3 {
      margin-top: 0;
      color: #5c33a2; /* Cor roxa */
    }
    .activity-card p {
      margin: 6px 0;
    }
    .activity-card a {
      color: #0077cc; /* Azul para links */
      text-decoration: none;
    }
    .activity-card a:hover {
      text-decoration: underline;
    }
    /* Estilo específico para o input da barra de busca */
    .search-bar input {
      border: 2px solid #5c33a2; /* Borda roxa mais evidente */
    }
    /* Estilo para o rodapé */
    .footer {
      text-align: center;
      margin-top: 40px;
      font-size: 14px;
      color: #888;
    }
    /* Estilo para o grupo de botões no formulário */
    .form-buttons {
      display: flex;
      justify-content: flex-end; /* Alinha os botões à direita */
      gap: 10px; /* Espaço entre os botões */
      margin-top: 15px;
    }

    /* Estilos para o novo componente de configurações de fundo */
    .background-settings {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      text-align: center;
    }

    .background-settings input[type="color"],
    .background-settings input[type="text"] { /* Alterado de file para text */
      width: auto; /* Ajuste para não ocupar 100% */
      margin: 10px;
      display: inline-block; /* Para alinhar lado a lado */
      vertical-align: middle;
    }

    .background-settings .options-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 15px;
    }

    .background-settings .options-buttons button {
        margin-right: 0; /* Remove a margem extra do botão */
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Acervo de Musicalização</h1>
    <div id="root"></div> </div>

  <script src="https://www.gstatic.com/firebasejs/9/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9/firebase-firestore-compat.js"></script>

  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>


  <script type="text/babel">
    // SUAS CREDENCIAIS DO FIREBASE FORAM COLOCADAS AQUI:
    const firebaseConfig = {
      apiKey: "AIzaSyAk5nYXl-qElWhMHQlytuV0KsbkfMLKp3w",
      authDomain: "meuacervoonline-c9473.firebaseapp.com",
      projectId: "meuacervoonline-c9473",
      storageBucket: "meuacervoonline-c9473.firebasestorage.app",
      messagingSenderId: "570611243354",
      appId: "1:570611243354:web:43d4209a6c55c8dc313b63"
    };

    // Inicializa o Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = app.firestore(); // Obtém a referência para o Firestore

    const { useState, useEffect, useRef } = React;

    // Componente para o formulário de adicionar/editar atividades
    function ActivityForm({ onSave, currentActivity, onCancelEdit }) {
      const [title, setTitle] = useState('');
      const [description, setDescription] = useState('');
      const [keywords, setKeywords] = useState('');
      const [videoLink, setVideoLink] = useState('');

      useEffect(() => {
        if (currentActivity) {
          setTitle(currentActivity.title);
          setDescription(currentActivity.description);
          setKeywords(currentActivity.keywords ? currentActivity.keywords.join(', ') : '');
          setVideoLink(currentActivity.videoLink || '');
        } else {
          setTitle('');
          setDescription('');
          setKeywords('');
          setVideoLink('');
        }
      }, [currentActivity]);

      const handleSubmit = (e) => {
        e.preventDefault();
        if (!title.trim() || !description.trim() || !keywords.trim()) {
          alert('Título, descrição e palavras-chave não podem ser vazios.');
          return;
        }
        onSave({
          id: currentActivity ? currentActivity.id : null, // ID será gerenciado pelo Firestore ao adicionar
          title,
          description,
          keywords: keywords.split(',').map(k => k.trim()).filter(k => k), // Filtra palavras-chave vazias
          videoLink
        });
        setTitle('');
        setDescription('');
        setKeywords('');
        setVideoLink('');
      };

      return (
        <form onSubmit={handleSubmit} className="activity-form">
          <h2>{currentActivity ? 'Editar Atividade' : 'Adicionar Nova Atividade'}</h2>
          <input type="text" placeholder="Título da Atividade" value={title} onChange={(e) => setTitle(e.target.value)} required />
          <textarea placeholder="Descrição da Atividade" value={description} onChange={(e) => setDescription(e.target.value)} required />
          <input type="text" placeholder="Palavras-chave (separadas por vírgulas)" value={keywords} onChange={(e) => setKeywords(e.target.value)} required />
          <input type="text" placeholder="Link do vídeo (opcional)" value={videoLink} onChange={(e) => setVideoLink(e.target.value)} />
          <div className="form-buttons">
            <button type="submit">{currentActivity ? 'Salvar Edição' : 'Salvar Atividade'}</button>
            {currentActivity && (
              <button type="button" className="cancel-button" onClick={onCancelEdit}>Cancelar</button>
            )}
          </div>
        </form>
      );
    }

    // Componente para a barra de busca
    function SearchBar({ onSearch }) {
      const [localSearchTerm, setLocalSearchTerm] = useState('');
      const debounceTimeout = useRef(null);

      const handleChange = (e) => {
        const value = e.target.value;
        setLocalSearchTerm(value);

        if (debounceTimeout.current) {
          clearTimeout(debounceTimeout.current);
        }

        debounceTimeout.current = setTimeout(() => {
          onSearch(value);
        }, 300);
      };

      return (
        <div className="search-bar">
          <h2>Buscar Atividade</h2>
          <input
            type="text"
            placeholder="Digite uma palavra-chave..."
            value={localSearchTerm}
            onChange={handleChange}
          />
        </div>
      );
    }

    // Componente para um item de atividade individual
    function ActivityItem({ activity, onDelete, onEdit }) {
      return (
        <div className="activity-card">
          <h3>{activity.title}</h3>
          <p>{activity.description}</p>
          <p><strong>Palavras-chave:</strong> {activity.keywords.join(', ')}</p>
          {activity.videoLink && (
            <p><a href={activity.videoLink} target="_blank" rel="noopener noreferrer">Ver Vídeo</a></p>
          )}
          <div className="activity-actions">
              <button className="edit-button" onClick={() => onEdit(activity)}>Editar</button>
              <button className="delete-button" onClick={() => onDelete(activity.id)}>Apagar</button>
          </div>
        </div>
      );
    }

    // Componente para a lista de atividades
    function ActivityList({ activities, onDelete, onEdit }) {
      return (
        <div className="activity-list">
          <h2>Atividades Salvas</h2>
          {activities.length === 0 ? (
            <p>Nenhuma atividade encontrada.</p>
          ) : (
            activities.map((activity) => (
              <ActivityItem
                key={activity.id}
                activity={activity}
                onDelete={onDelete}
                onEdit={onEdit}
              />
            ))
          )}
        </div>
      );
    }

    // Componente para as configurações de plano de fundo
    function BackgroundSettings({ onApplyBackground, onClose, currentBackground }) {
      const [bgColor, setBgColor] = useState('');
      const [bgImageUrl, setBgImageUrl] = useState(''); // Estado para URL da imagem
      const [gradientColors, setGradientColors] = useState('');
      const [isAnimated, setIsAnimated] = useState(true); // Adicionado para controlar animação do gradiente
      const [gradientDirection, setGradientDirection] = useState('45deg'); // Direção do gradiente

      useEffect(() => {
        if (currentBackground) {
          if (currentBackground.type === 'color') {
            setBgColor(currentBackground.value);
            setBgImageUrl('');
            setGradientColors('');
          } else if (currentBackground.type === 'image') {
            setBgImageUrl(currentBackground.value);
            setBgColor('');
            setGradientColors('');
          } else if (currentBackground.type === 'gradient') {
            setGradientColors(currentBackground.value.colors);
            setIsAnimated(currentBackground.value.animated);
            setGradientDirection(currentBackground.value.direction);
            setBgColor('');
            setBgImageUrl('');
          }
        }
      }, [currentBackground]);

      const handleColorChange = (e) => {
        setBgColor(e.target.value);
        setBgImageUrl('');
        setGradientColors('');
      };

      const handleImageUrlChange = (e) => {
        setBgImageUrl(e.target.value);
        setBgColor('');
        setGradientColors('');
      };

      const handleGradientColorsChange = (e) => {
        setGradientColors(e.target.value);
        setBgColor('');
        setBgImageUrl('');
      };

      const applySettings = () => {
        if (bgColor) {
          onApplyBackground({ type: 'color', value: bgColor });
        } else if (bgImageUrl) {
          onApplyBackground({ type: 'image', value: bgImageUrl });
        } else if (gradientColors) {
            onApplyBackground({
                type: 'gradient',
                value: {
                    colors: gradientColors,
                    direction: gradientDirection,
                    animated: isAnimated
                }
            });
        } else {
            alert('Por favor, selecione uma cor, imagem ou gradiente para o fundo.');
            return;
        }
        onClose();
      };

      const resetBackground = () => {
          onApplyBackground({ type: 'default' });
          setBgColor('');
          setBgImageUrl('');
          setGradientColors('#FFD1DC, #C3F8FF, #D1FFC3');
          setIsAnimated(true);
          setGradientDirection('45deg');
          onClose();
      }

      return (
        <div className="background-settings">
          <h2>Configurações de Plano de Fundo</h2>
          <div>
            <h3>Cor Sólida:</h3>
            <input type="color" value={bgColor} onChange={handleColorChange} />
          </div>
          <div>
            <h3>Imagem de Fundo (URL):</h3>
            <input
              type="text"
              placeholder="Insira a URL da imagem"
              value={bgImageUrl}
              onChange={handleImageUrlChange}
            />
          </div>
          <div>
            <h3>Gradiente Personalizado:</h3>
            <p>Ex: #FFD1DC, #C3F8FF, #D1FFC3 (separado por vírgulas)</p>
            <input
                type="text"
                placeholder="Cores do gradiente (ex: #FFD1DC, #C3F8FF)"
                value={gradientColors}
                onChange={handleGradientColorsChange}
            />
            <label style={{display: 'block', marginTop: '10px'}}>
                Direção:
                <select value={gradientDirection} onChange={(e) => setGradientDirection(e.target.value)} style={{marginLeft: '5px'}}>
                    <option value="to right">Para a direita</option>
                    <option value="to bottom right">Para baixo e direita</option>
                    <option value="to bottom">Para baixo</option>
                    <option value="to bottom left">Para baixo e esquerda</option>
                    <option value="to left">Para a esquerda</option>
                    <option value="to top left">Para cima e esquerda</option>
                    <option value="to top">Para cima</option>
                    <option value="to top right">Para cima e direita</option>
                    <option value="45deg">45 Graus</option>
                    <option value="90deg">90 Graus</option>
                    <option value="180deg">180 Graus</option>
                </select>
            </label>
            <label style={{display: 'block', marginTop: '10px'}}>
                <input
                    type="checkbox"
                    checked={isAnimated}
                    onChange={(e) => setIsAnimated(e.target.checked)}
                />
                Animar Gradiente
            </label>
          </div>
          <div className="options-buttons">
            <button onClick={applySettings}>Aplicar Fundo</button>
            <button className="cancel-button" onClick={resetBackground}>Fundo Padrão</button>
            <button className="cancel-button" onClick={onClose}>Fechar</button>
          </div>
        </div>
      );
    }

    // Componente principal da aplicação
    function App() {
      const [activities, setActivities] = useState([]);
      const [searchTerm, setSearchTerm] = useState('');
      const [activityToEdit, setActivityToEdit] = useState(null);
      const [showBackgroundSettings, setShowBackgroundSettings] = useState(false);
      const [backgroundStyle, setBackgroundStyle] = useState({
        type: 'gradient',
        value: {
            colors: '#FFD1DC, #C3F8FF, #D1FFC3',
            direction: '45deg',
            animated: true
        }
      });

      // Efeito para carregar atividades do Firestore e o background salvo
      useEffect(() => {
        // Carrega atividades em tempo real do Firestore
        const unsubscribeActivities = db.collection('activities').onSnapshot(snapshot => {
          const loadedActivities = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
          }));
          setActivities(loadedActivities);
        }, error => {
            console.error("Erro ao carregar atividades:", error);
            alert('Ocorreu um erro ao carregar as atividades. Verifique o console.');
        });

        // Carrega o background salvo do Firestore
        const unsubscribeBackground = db.collection('settings').doc('appBackground').onSnapshot(doc => {
            if (doc.exists) {
                const savedBackground = doc.data().style;
                // Garante valores padrão para propriedades que podem não ter sido salvas antes
                if (savedBackground.type === 'gradient') {
                    savedBackground.value = {
                        colors: savedBackground.value.colors || '#FFD1DC, #C3F8FF, #D1FFC3',
                        direction: savedBackground.value.direction || '45deg',
                        animated: savedBackground.value.animated !== undefined ? savedBackground.value.animated : true
                    };
                }
                setBackgroundStyle(savedBackground);
            } else {
                // Se não há background salvo, aplica o padrão inicial
                setBackgroundStyle({
                    type: 'gradient',
                    value: {
                        colors: '#FFD1DC, #C3F8FF, #D1FFC3',
                        direction: '45deg',
                        animated: true
                    }
                });
            }
        }, error => {
            console.error("Erro ao carregar configurações de background:", error);
            alert('Ocorreu um erro ao carregar as configurações de plano de fundo. Verifique o console.');
        });

        // Retorna uma função de limpeza para desinscrever os listeners quando o componente desmontar
        return () => {
            unsubscribeActivities();
            unsubscribeBackground();
        };
      }, []);


      // Efeito para aplicar o estilo de fundo ao elemento <body>
      useEffect(() => {
          const body = document.body;
          // Limpa estilos anteriores
          body.style.backgroundColor = '';
          body.style.backgroundImage = '';
          body.style.backgroundSize = '';
          body.style.backgroundRepeat = '';
          body.style.backgroundPosition = '';
          body.style.backgroundAttachment = '';
          body.style.animation = '';

          // Aplica o novo estilo
          if (backgroundStyle.type === 'color') {
              body.style.backgroundColor = backgroundStyle.value;
          } else if (backgroundStyle.type === 'image') {
              body.style.backgroundImage = `url('${backgroundStyle.value}')`;
              body.style.backgroundSize = 'cover';
              body.style.backgroundRepeat = 'no-repeat';
              body.style.backgroundPosition = 'center center';
              body.style.backgroundAttachment = 'fixed';
          } else if (backgroundStyle.type === 'gradient') {
              const { colors, direction, animated } = backgroundStyle.value;
              body.style.backgroundImage = `linear-gradient(${direction}, ${colors})`;
              if (animated) {
                body.style.backgroundSize = '400% 400%';
                body.style.animation = 'gradientAnimation 15s ease infinite';
              } else {
                body.style.backgroundSize = 'auto auto';
                body.style.animation = 'none';
              }
          } else if (backgroundStyle.type === 'default') {
              // Reverte para o gradiente padrão animado
              body.style.backgroundImage = `linear-gradient(45deg, #FFD1DC, #C3F8FF, #D1FFC3)`;
              body.style.backgroundSize = '400% 400%';
              body.style.animation = 'gradientAnimation 15s ease infinite';
          }
      }, [backgroundStyle]);


      // Função para salvar uma atividade no Firestore (adicionar ou editar)
      const saveActivity = async (activity) => {
        try {
          if (activity.id) {
            // Edita atividade existente
            await db.collection('activities').doc(activity.id).update(activity);
            alert('Atividade atualizada com sucesso!');
          } else {
            // Adiciona nova atividade, Firestore gera o ID
            await db.collection('activities').add(activity);
            alert('Atividade adicionada com sucesso!');
          }
          setActivityToEdit(null); // Limpa o estado de edição
        } catch (error) {
          console.error("Erro ao salvar atividade:", error);
          alert('Ocorreu um erro ao salvar a atividade. Verifique o console para mais detalhes.');
        }
      };

      // Função para deletar uma atividade do Firestore
      const deleteActivity = async (id) => {
        if (window.confirm('Tem certeza que deseja apagar esta atividade?')) {
          try {
            await db.collection('activities').doc(id).delete();
            alert('Atividade apagada com sucesso!');
          } catch (error) {
            console.error("Erro ao apagar atividade:", error);
            alert('Ocorreu um erro ao apagar a atividade. Verifique o console para mais detalhes.');
          }
        }
      };

      // Função para carregar uma atividade para edição
      const editActivity = (activity) => {
        setActivityToEdit(activity);
      };

      const cancelEdit = () => {
        setActivityToEdit(null);
      };

      // Função para aplicar e salvar o background no Firestore
      const applyBackground = async (style) => {
        setBackgroundStyle(style);
        try {
            // Salva o estilo do background no Firestore em um documento fixo 'appBackground' na coleção 'settings'
            await db.collection('settings').doc('appBackground').set({ style: style });
            alert('Plano de fundo salvo com sucesso!');
        } catch (error) {
            console.error("Erro ao salvar plano de fundo:", error);
            alert('Ocorreu um erro ao salvar o plano de fundo. Verifique o console para mais detalhes.');
        }
      };

      // Filtra as atividades com base no termo de busca (título, descrição, palavras-chave)
      const filteredActivities = activities.filter(
        activity =>
        activity.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
        activity.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
        (activity.keywords && activity.keywords.some(keyword =>
            keyword.toLowerCase().includes(searchTerm.toLowerCase())
        ))
      );

      return (
        <>
          <div style={{textAlign: 'right', marginBottom: '20px'}}>
              <button onClick={() => setShowBackgroundSettings(!showBackgroundSettings)} className="settings-button">
                  {showBackgroundSettings ? 'Fechar Configurações' : 'Mudar Plano de Fundo'}
              </button>
          </div>

          {showBackgroundSettings && (
            <BackgroundSettings
              onApplyBackground={applyBackground}
              onClose={() => setShowBackgroundSettings(false)}
              currentBackground={backgroundStyle}
            />
          )}

          <ActivityForm
            onSave={saveActivity}
            currentActivity={activityToEdit}
            onCancelEdit={cancelEdit}
          />
          <SearchBar onSearch={setSearchTerm} />
          <ActivityList
            activities={filteredActivities}
            onDelete={deleteActivity}
            onEdit={editActivity}
          />
        </>
      );
    }

    // Renderiza o componente principal 'App' no elemento com id 'root'
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>

  <div class="footer">Desenvolvido para educadores de musicalização por Jemelly Xavier</div>
</body>
</html>